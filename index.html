<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ö–∞—Ä—Ç–∞ –∏–º–ø–æ—Ä—Ç–æ–∑–∞–º–µ—â–µ–Ω–∏—è</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>

<style>
body { margin:0; font-family:Arial,sans-serif; background:#f5f5f5; }
header {
  background:#1f4fa3;
  color:white;
  padding:12px 16px;
  display:flex;
  flex-wrap: wrap;
  gap:10px;
  align-items:center;
  justify-content: space-between;
  box-shadow:0 2px 6px rgba(0,0,0,0.2);
}
header div, header button { margin: 2px; }
#map { height: calc(100vh - 64px); width:100%; transition: background 0.5s; }

select, button {
  padding:6px 10px;
  font-size:15px;
  border-radius:4px;
  border:none;
  cursor:pointer;
  transition:0.3s;
}
select { min-width: 150px; }
select:hover, button:hover { opacity:0.85; }
button { background:#ffb74d; color:#000; font-weight:bold; }

.popup-img {
  width:100%;
  max-width:220px;
  margin-bottom:6px;
  border-radius:6px;
  transition: transform 0.3s;
}
.popup-img:hover { transform: scale(1.05); }

@media (max-width:600px){
  header { flex-direction: column; align-items:stretch; }
  select, button { width:100%; margin-top:5px; }
  #map { height: calc(100vh - 180px); }
}
</style>
</head>
<body>

<header>
  <div>–ö–∞—Ä—Ç–∞ –∏–º–ø–æ—Ä—Ç–æ–∑–∞–º–µ—â–µ–Ω–∏—è</div>
  <div>
    <select id="typeFilter"><option value="all">–í—Å–µ —Ç–∏–ø—ã</option></select>
    <select id="regionFilter"><option value="all">–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã</option></select>
  </div>
  <div>
    <button id="toggleTheme">üåô –ù–æ—á–Ω–∞—è —Ç–µ–º–∞</button>
  </div>
</header>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
const map = L.map('map').setView([60,90],4);

// –°–ª–æ–∏ –∫–∞—Ä—Ç—ã
const dayLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution:'¬© OpenStreetMap'
}).addTo(map);

const nightLayer = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_dark/{z}/{x}/{y}{r}.png',{
  attribution:'¬© Stadia Maps, ¬© OpenStreetMap'
});

let nightMode = false;

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
function toggleTheme(forceNight=null){
  if(forceNight!==null) nightMode=forceNight;
  else nightMode=!nightMode;

  if(nightMode){
    map.removeLayer(dayLayer);
    nightLayer.addTo(map);
    document.getElementById("toggleTheme").textContent="‚òÄÔ∏è –î–Ω–µ–≤–Ω–∞—è —Ç–µ–º–∞";
    document.body.style.background="#222";
  } else {
    map.removeLayer(nightLayer);
    dayLayer.addTo(map);
    document.getElementById("toggleTheme").textContent="üåô –ù–æ—á–Ω–∞—è —Ç–µ–º–∞";
    document.body.style.background="#f5f5f5";
  }
}

// –ê–≤—Ç–æ–Ω–æ—á—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏
const hour = new Date().getHours();
if(hour>=20 || hour<6) toggleTheme(true);

// –ö–Ω–æ–ø–∫–∞ —Ä—É—á–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
document.getElementById("toggleTheme").onclick = () => toggleTheme();

// –î–∞–Ω–Ω—ã–µ –∑–∞–≤–æ–¥–æ–≤ (–ø—Ä–∏–º–µ—Ä)
const factories = [
  {name:"–û–û–û ¬´–ë–æ—Ä–µ—Ü¬ª", city:"–ß–µ–ª—è–±–∏–Ω—Å–∫", region:"–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", type:"–ù–∞—Å–æ—Å–Ω–æ–µ –∏ —Å–∫–≤–∞–∂–∏–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ", coords:[55.1644,61.4368], image:"images/borets.png", desc:"–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –Ω–∞—Å–æ—Å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ."},
  {name:"–ó–∏–û-–ü–æ–¥–æ–ª—å—Å–∫–∏–π –ê–û", city:"–ü–æ–¥–æ–ª—å—Å–∫", region:"–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", type:"–¢–µ–ø–ª–æ–æ–±–º–µ–Ω–Ω–∏–∫–∏ –∏ —Å–æ—Å—É–¥—ã", coords:[55.4227,37.5557], image:"images/ziopodolsk.png", desc:"–ò–∑–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–ø–ª–æ–æ–±–º–µ–Ω–Ω–∏–∫–∏."},
  {name:"–ö–∞–∑–∞–Ω—Å–∫–∏–π –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä–Ω—ã–π –∑–∞–≤–æ–¥", city:"–ö–∞–∑–∞–Ω—å", region:"–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω", type:"–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä—ã", coords:[55.7961,49.1064], image:"images/compress.png", desc:"–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä—ã."}
  // ‚Ä¶ –≤—Å—Ç–∞–≤—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–≤–æ–¥—ã
];

// –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤
const markers = L.markerClusterGroup();
map.addLayer(markers);

// –§–∏–ª—å—Ç—Ä—ã
const typeFilter=document.getElementById("typeFilter");
const regionFilter=document.getElementById("regionFilter");
[...new Set(factories.map(f=>f.type))].forEach(t=>typeFilter.add(new Option(t,t)));
[...new Set(factories.map(f=>f.
region))].forEach(r=>regionFilter.add(new Option(r,r)));

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–∞—Ä–∫–µ—Ä–æ–≤
function render(){
  markers.clearLayers();
  factories.forEach(f=>{
    if((typeFilter.value!=="all" && f.type!==typeFilter.value) ||
       (regionFilter.value!=="all" && f.region!==regionFilter.value)) return;
    const img=f.image||"images/default.png";
    const popup=`<img src="${img}" class="popup-img"><b>${f.name}</b><br>${f.city}<br><i>${f.type}</i><br>${f.desc}`;
    markers.addLayer(L.marker(f.coords).bindPopup(popup));
  });
}

typeFilter.onchange=render;
regionFilter.onchange=render;
render();
</script>
</body>
</html>